# This is an STM32H745I-DISCO board with a single STM32H745XIHx chip
#
# Generated by STM32CubeIDE
# Take care that such file, as generated, may be overridden without any early notice. Please have a look to debug launch configuration setup(s)

#source [find interface/stlink.cfg]
source [find interface/stlink-dap.cfg]

# Define the chip and board names
set _CHIPNAME STM32H745XIHx
set _BOARDNAME STM32H745I-DISCO
set _TARGETNAME $_CHIPNAME.cm7


# QSPI Flash settings
set QUADSPI_SIZE 0x4000000
set QUADSPI_BASE 0x90000000


proc qspi_init { } {
    # Enable GPIO clocks
    mww 0x58024540 0x00000002
    mww 0x58024400 0x00000007
    sleep 10

    # Configure GPIO pins for QSPI
    mww 0x58020400 0x0AA00AAA
    mww 0x58020408 0x0000FFF0
    mww 0x58020420 0x0AA00AAA

    mww 0x58020800 0x0000000A
    mww 0x58020808 0x0000000F
    mww 0x58020820 0x0000009A

    mww 0x58020C00 0x0000000A
    mww 0x58020C08 0x0000000F
    mww 0x58020C20 0x0000009A
    sleep 10

    # Reset QSPI
    mww 0x52005000 0x00000000
    sleep 10

    # Configure QSPI
    mww 0x52005000 0x00000005
    sleep 10

    # Clear any pending flags
    mww 0x52005004 0x00000000
    sleep 10

    # Configure Flash parameters
    mww 0x52005014 0x00000001
    sleep 10

    # Configure for memory mapped mode
    mww 0x5200510C 0x0B002503
    sleep 10

    # Enable memory mapped mode
    mww 0x52005000 0x0000000F
    sleep 50
}

set WORKAREASIZE 0x8000

transport select "dapdirect_swd"

set CHIPNAME STM32H745XIHx
set BOARDNAME STM32H745I-DISCO

# Enable debug when in low power modes
set ENABLE_LOW_POWER 1

# Stop Watchdog counters when halt
set STOP_WATCHDOG 1

# STlink Debug clock frequency
set CLOCK_FREQ 8000

# Reset configuration
# use hardware reset, connect under reset
# connect_assert_srst needed if low power mode application running (WFI...)
reset_config srst_only srst_nogate connect_assert_srst
#reset_config srst_only connect_assert_srst

set CONNECT_UNDER_RESET 1
set CORE_RESET 1

# ACCESS PORT NUMBER
set AP_NUM 0
# GDB PORT
set GDB_PORT 3333

set CM4 1
set CM7 0

set DUAL_BANK 1

set DUAL_CORE 1

# BCTM CPU variables

source [find target/stm32h7x.cfg]

#flash bank $_CHIPNAME.qspi stm32h7x_qspi 0x90000000 0x4000000 0 0 $_TARGETNAME


